<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>From MelbourneÂ â†’Â Kuwait: My Apology</title>

<!-- Fonts & libs -->
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&family=Pacifico&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.2/anime.min.js"></script>
<script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
:root{
  --pink:#FFC9E0;--pink-dark:#FFA4C8;--navy:#0A1D37;--navy-light:#344767;--bg:#FFFAFD;
}
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:'Quicksand',sans-serif;background:var(--bg);color:var(--navy);
  min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:3rem 1rem 5rem;
}
h1{
  font-family:'Pacifico',cursive;font-size:clamp(2.2rem,5vw,3.5rem);text-align:center;
  background:linear-gradient(90deg,var(--pink-dark),var(--pink));-webkit-background-clip:text;color:transparent;
}
.subtitle{margin:.8rem 0 2.2rem;text-align:center;font-size:1.1rem;max-width:650px;line-height:1.6}
.section{width:100%;max-width:900px;margin:2.8rem auto}

/* Map */
#map{width:100%;height:340px;border-radius:1rem;overflow:hidden;box-shadow:0 6px 16px rgba(0,0,0,.08)}
.distBox{
  margin-top:1rem;font-size:1.25rem;font-weight:600;text-align:center;
}
.distBox span{background:var(--pink-dark);color:#fff;padding:.1rem .55rem;border-radius:.55rem}

/* Forgiveness meter */
#meterWrap{background:#fff;border-radius:1rem;box-shadow:0 6px 16px rgba(0,0,0,.06);padding:2rem 1.5rem;text-align:center}
#meterWrap h2{font-family:'Pacifico',cursive;font-size:2rem;margin-bottom:1.1rem}
.hearts{display:flex;gap:.65rem;justify-content:center;margin-bottom:1.3rem;flex-wrap:wrap}
.heartSlot{
  font-size:2rem;cursor:pointer;transition:.25s;color:#d3d3d3;user-select:none;
}
.heartSlot:hover{transform:translateY(-3px)}
.heartSlot.on{color:#FF5E8E;transform:scale(1.18)}
#progressText{font-weight:600;font-size:1.05rem}

/* back link */
a.back{display:inline-block;margin-top:2.6rem;text-decoration:none;font-weight:600;color:#fff;
  background:linear-gradient(135deg,var(--navy),var(--navy-light));padding:.75rem 1.45rem;border-radius:999px;transition:.25s}
a.back:hover{transform:translateY(-2px);box-shadow:0 6px 14px rgba(0,0,0,.15)}

/* Confetti dots */
.dot{position:fixed;width:10px;height:10px;border-radius:50%;pointer-events:none;z-index:9999}
@keyframes fly{to{transform:translate(var(--dx),var(--dy)) rotate(720deg);opacity:0}}
</style>
</head>
<body>
  <h1>For My Anne</h1>
  <p class="subtitle">Across <strong>13Â 000&nbsp;+ km</strong> of ocean and desert, my heart keeps whispering one thing: <em>Iâ€™m sorry.</em> I never want distanceâ€”or my own fearsâ€”to make you feel pressured again. This page is a promise that I will do better and love you in ways that make you feel <span style="background:var(--pink);padding:0 .3rem;border-radius:.3rem">safe</span>.</p>

  <!-- Map Section -->
  <section class="section" id="mapSection">
    <div id="map" aria-label="Map showing Melbourne and Kuwait"></div>
    <p class="distBox">Weâ€™re <span id="km"></span> apart right now â€” but youâ€™re always right here with me ğŸ’—</p>
  </section>

  <!-- Forgiveness Meter -->
  <section class="section" id="meterWrap">
    <h2>ForgivenessÂ Meter</h2>
    <p style="margin-bottom:1rem">Tap the hearts each time you feel a little more okay. When theyâ€™re all pink, Iâ€™ll know youâ€™ve forgiven me (and Iâ€™ll keep earning it every day).</p>
    <div class="hearts" id="heartBar"></div>
    <p id="progressText">0Â /Â 10 hearts filled</p>
  </section>

  <!-- Voice-apology placeholder -->
  <section class="section" style="text-align:center">
    <h2 style="font-family:'Pacifico',cursive;font-size:1.8rem;margin-bottom:1rem">My voice, my heart</h2>
    <p style="margin-bottom:1rem">Press play whenever you want to hear me say it.</p>
    <audio id="apologyAudio" controls src="apology.mp3" style="width:100%;max-width:400px"></audio>
  </section>

  <a href="index.html" class="back">â† Back to our home page</a>

<!-- Scripts -->
<!-- note: external libs keep defer so they load *before* DOMContentLoaded fires -->
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.2/anime.min.js"></script>
<script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- our logic now waits for DOMContentLoaded so Leaflet & Anime are guaranteed loaded -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    /******** Map (unchanged) ********/
    const melb=[-37.8136,144.9631],kuw=[29.3759,47.9774];
    /* â€¦Â all your map code â€¦ */

    /******** Forgiveness Meter ********/
    const bar = document.getElementById('heartBar');
    const TOTAL = 10;
    let state = parseInt(localStorage.getItem('forgiveCount')) || 0;
    const OFF = 'ğŸ¤', ON = 'ğŸ’–';

    function render () {
      bar.innerHTML = '';
      for (let i = 0; i < TOTAL; i++) {
        const slot = document.createElement('div');
        slot.className = 'heartSlot' + (i < state ? ' on' : '');
        slot.textContent = i < state ? ON : OFF;
        slot.dataset.index = i;
        bar.appendChild(slot);
      }
      document.getElementById('progressText').textContent =
        `${state} / ${TOTAL} hearts filled`;
    }

    /* NEW click logic: toggle up OR down */
    bar.addEventListener('click', e => {
      const slot = e.target.closest('.heartSlot');
      if (!slot) return;
      const idx = +slot.dataset.index;

      // if you clicked a filled heart, shrink to that many;
      // if you clicked an empty heart, grow up to it.
      state = (idx < state) ? idx : idx + 1;
      state = Math.max(0, Math.min(state, TOTAL));

      localStorage.setItem('forgiveCount', state);
      render();
      if (state === TOTAL) celebrate();
    });

    /* celebration & first render stay the same */
    function celebrate () {
      for (let i = 0; i < 140; i++) {
        const dot = document.createElement('span');
        dot.className = 'dot';
        dot.style.background = ['#FFC9E0','#FFA4C8','#FCD3E5','#FFECF6'][
          Math.floor(Math.random()*4)
        ];
        dot.style.left = `${window.innerWidth/2}px`;
        dot.style.top  = `${window.innerHeight/2}px`;
        const dx = (Math.random()*2-1)*800,
              dy = (Math.random()*2-1)*800;
        dot.style.setProperty('--dx', dx + 'px');
        dot.style.setProperty('--dy', dy + 'px');
        dot.style.animation = `fly 1.6s ease-out forwards`;
        document.body.appendChild(dot);
        setTimeout(() => dot.remove(), 1600);
      }
    }

    render();
  });
</script>
</body>
</html>
